# 结构硬件支持

## 操作系统虚拟机

在裸机上配置了操作系统程序后就构了操作系统虚拟机。操作系统的核心在裸机上运行；用户程序在扩充后的机器上运行。

## 操作系统的体系结构

### 单一内核结构

操作系统功能由单一内核提供，包括调度、文件系统、设备驱动、存储管理等。如 LINUX

![](/os2-1.png)

### 微内核结构

微内核仅包括地址空间、进程间通信（IPC）、最基本调度等最基本功能，其他 OS 服务都是由运行在用户模式下的进程提供的。如 MACH 和 WIN2000

![](/os2-2.png)

![](/os2-3.png)

## 区分处理机的态

处理机的态，又称为处理机的特权级，是中央处理机的工作状态。当前处理机正在执行哪类程序，决定处理机的态

区分处理机状态的目的：保护操作系统

系统中两类程序的职责和区别

|   管理程序   |      用户程序      |
| :----------: | :----------------: |
| 管理系统资源 | 使用资源，提出申请 |
| 控制程序运行 |       被控制       |

## 管态、用户态，二者的区别

- 管态 (Supervisor mode)
  - 操作系统的管理程序执行时机器所处的状态，又称处理机的特权级。在此状态下处理机可使用全部指令(包括一组特权指令)；使用全部系统资源(包括整个存储区域)。
- 用户态(User mode)

  - 用户程序执行时机器所处的状态称为用户态。在此状态下禁止使用特权指令，不能直接取用资源与改变机器状态，并且只允许用户程序访问自己的存储区域

|        管态        |       用户态       |
| :----------------: | :----------------: |
| 操作系统的程序执行 |    用户程序执行    |
|    使用全部指令    |  禁止使用特权指令  |
|  使用全部系统资源  |   只允许用户程序   |
| (包括整个存储区域) | 访问自己的存储区域 |

## 中断的定义、类型

所谓中断是指某个事件 (例如电源掉电、定点加法溢出或 I/O 传输结束等) 发生时，系统中止现行程序的运行、引出处理事件程序对该事件进行处理，处理完毕后返回断点继续执行的过程

### 按中断功能分类

- 输入输出中断 --- I/O 传输结束或出错中断
- 外中断 --- 时钟中断、操作员控制台中断、通信中断等
- 机器故障中断 --- 电源故障、主存取指令错等
- 程序性中断 --- 定点溢出、用户态下用核态指令、非法操作
- 访管中断 --- 对操作系统提出某种需求时所发出的中断

### 按中断方式分类

- 强迫性中断

不是正在运行的程序所期待的中断。如：输入输出中断、外中断、机器故障中断、程序性中断

- 自愿中断

是运行程序所期待的事件。如：访管中断

### 按中断来源分类

- 中断 --- 由处理机外部事件引起的中断
- 俘获 --- 由处理机内部事件引起的中断

![](/os2-4.png)

## 中断响应的定义、实质、所需的硬件支持

中断响应是当中央处理机发现已有中断请求时，中止现行程序执行，并自动引出中断处理程序的过程。

## 实质

交换指令地址及处理机的状态信息

### 硬件支持

![](/os2-5.png)

![](/os2-6.png)


## 软件中断处理过程

当硬件完成了中断进入过程后，由相应的中断处理程序得到控制权，进入了软件的中断处理过程。 软件的中断处理过程如图所示。

![](/os2-7.png)

