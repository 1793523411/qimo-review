# è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼ï¼ˆä¸‹ï¼‰

## è§‚å¯Ÿè€…æ¨¡å¼ ğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸ

**å®šä¹‰**

æŒ‡ å¤šä¸ªå¯¹è±¡é—´å­˜åœ¨ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œå½“ä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œæ‰€æœ‰ä¾èµ–äºå®ƒçš„å¯¹è±¡éƒ½å¾—åˆ°é€šçŸ¥å¹¶è¢«è‡ªåŠ¨æ›´æ–°

**ä¼˜ç¼ºç‚¹**

- ä¼˜ç‚¹ï¼š1ï¼‰é™ä½äº†ç›®æ ‡ä¸è§‚å¯Ÿè€…ä¹‹é—´çš„è€¦åˆå…³ç³»ï¼Œä¸¤è€…ä¹‹é—´æ˜¯æŠ½è±¡è€¦åˆå…³ç³»ï¼›2ï¼‰ç›®æ ‡ä¸è§‚å¯Ÿè€…ä¹‹é—´å»ºç«‹äº†ä¸€å¥—è§¦å‘æœºåˆ¶ã€‚

- ç¼ºç‚¹ï¼š1ï¼‰ç›®æ ‡ä¸è§‚å¯Ÿè€…ä¹‹é—´çš„ä¾èµ–å…³ç³»å¹¶æ²¡æœ‰å®Œå…¨è§£é™¤ï¼Œè€Œä¸”æœ‰å¯èƒ½å‡ºç°å¾ªç¯å¼•ç”¨ï¼›2ï¼‰å½“è§‚å¯Ÿè€…å¯¹è±¡å¾ˆå¤šæ—¶ï¼Œé€šçŸ¥çš„å‘å¸ƒä¼šèŠ±è´¹å¾ˆå¤šæ—¶é—´ï¼Œå½±å“ç¨‹åºçš„æ•ˆç‡

**ç¤ºä¾‹**

```java
import java.util.*;
public class ObserverPattern {
	public static void main(String[] args) {
		Subject subject=new ConcreteSubject();
		Observer obs1=new ConcreteObserver1();
		Observer obs2=new ConcreteObserver2();
		subject.add(obs1);
		subject.add(obs2);
		subject.notifyObserver();
	}
}
//æŠ½è±¡ç›®æ ‡
abstract class Subject
{
	protected List<Observer> observers = new ArrayList<Observer>();
	//å¢åŠ è§‚å¯Ÿè€…æ–¹æ³•
	public void add(Observer observer)
	{
		observers.add(observer);
	}
	//åˆ é™¤è§‚å¯Ÿè€…æ–¹æ³•
	public void remove(Observer observer)
	{
		observers.remove(observer);
	}
	public abstract void notifyObserver(); //é€šçŸ¥è§‚å¯Ÿè€…æ–¹æ³•
}
//å…·ä½“ç›®æ ‡
class ConcreteSubject extends Subject
{
	public void notifyObserver()
	{
		System.out.println("å…·ä½“ç›®æ ‡å‘ç”Ÿæ”¹å˜...");
		System.out.println("--------------");

		for(Object obs:observers)
		{
			((Observer)obs).response();
		}

	}
}
//æŠ½è±¡è§‚å¯Ÿè€…
interface Observer
{
	void response(); //ååº”
}
//å…·ä½“è§‚å¯Ÿè€…1
class ConcreteObserver1 implements Observer
{
	public void response()
	{
		System.out.println("å…·ä½“è§‚å¯Ÿè€…1ä½œå‡ºååº”ï¼");
	}
}
//å…·ä½“è§‚å¯Ÿè€…1
class ConcreteObserver2 implements Observer
{
	public void response()
	{
		System.out.println("å…·ä½“è§‚å¯Ÿè€…2ä½œå‡ºååº”ï¼");
	}
}
```

```java
import java.util.*;
public class BellEventTest {
	public static void main(String[] args) {
		BellEventSource bell = new BellEventSource();//é“ƒï¼ˆäº‹ä»¶æºï¼‰
        bell.addPersonListener(new TeachEventListener()); //æ³¨å†Œç›‘å¬å™¨ï¼ˆè€å¸ˆï¼‰
        bell.addPersonListener(new StuEventListener()); //æ³¨å†Œç›‘å¬å™¨ï¼ˆå­¦ç”Ÿï¼‰
        bell.ring(true);   //æ‰“ä¸Šè¯¾é“ƒå£°
        System.out.println("------------");
        bell.ring(false);  //æ‰“ä¸‹è¯¾é“ƒå£°
	}
}
//é“ƒå£°äº‹ä»¶ç±»ï¼šç”¨äºå°è£…äº‹ä»¶æºåŠä¸€äº›ä¸äº‹ä»¶ç›¸å…³çš„å‚æ•°
class RingEvent extends EventObject{
	private static final long serialVersionUID = 1L;
	private boolean sound; //trueè¡¨ç¤ºä¸Šè¯¾é“ƒå£°,falseè¡¨ç¤ºä¸‹è¯¾é“ƒå£°
	public RingEvent(Object source,boolean sound) {
		super(source);
		this.sound = sound;
	}
    public void setSound(boolean sound) {
    	this.sound = sound;
    }
    public boolean getSound() {
        return this.sound;
    }
}
//ç›®æ ‡ç±»ï¼šäº‹ä»¶æºï¼Œé“ƒ
class BellEventSource {
	private List<BellEventListener> listener; //ç›‘å¬å™¨å®¹å™¨
	public BellEventSource(){
        listener = new ArrayList<BellEventListener>();
    }
	//ç»™äº‹ä»¶æºç»‘å®šç›‘å¬å™¨
    public void addPersonListener(BellEventListener ren){
        listener.add(ren);
    }
	//äº‹ä»¶è§¦å‘å™¨ï¼šæ•²é’Ÿï¼Œå½“é“ƒå£°soundçš„å€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼Œè§¦å‘äº‹ä»¶ã€‚
	public void ring(boolean sound) {
		String type=sound?"ä¸Šè¯¾é“ƒ":"ä¸‹è¯¾é“ƒ";
		System.out.println(type+"å“ï¼");
		RingEvent event = new RingEvent(this, sound);
        notifies(event);//é€šçŸ¥æ³¨å†Œåœ¨è¯¥äº‹ä»¶æºä¸Šçš„æ‰€æœ‰ç›‘å¬å™¨
    }
    //å½“äº‹ä»¶å‘ç”Ÿæ—¶,é€šçŸ¥ç»‘å®šåœ¨è¯¥äº‹ä»¶æºä¸Šçš„æ‰€æœ‰ç›‘å¬å™¨åšå‡ºååº”ï¼ˆè°ƒç”¨äº‹ä»¶å¤„ç†æ–¹æ³•ï¼‰
	protected void notifies(RingEvent e){
		BellEventListener ren = null;
        Iterator<BellEventListener> iterator = listener.iterator();
        while(iterator.hasNext()){
        	ren = iterator.next();
        	ren.heardBell(e);
        }
    }
}
//æŠ½è±¡è§‚å¯Ÿè€…ç±»ï¼šé“ƒå£°äº‹ä»¶ç›‘å¬å™¨
interface  BellEventListener extends EventListener {
	//äº‹ä»¶å¤„ç†æ–¹æ³•ï¼Œå¬åˆ°é“ƒå£°
	public void heardBell(RingEvent e);
}
//å…·ä½“è§‚å¯Ÿè€…ç±»ï¼šè€å¸ˆäº‹ä»¶ç›‘å¬å™¨
class TeachEventListener implements BellEventListener {
	public void heardBell(RingEvent e){
		if(e.getSound()){
			System.out.println("è€å¸ˆä¸Šè¯¾äº†...");
		}else{
			System.out.println("è€å¸ˆä¸‹è¯¾äº†...");
		}
    }
}
//å…·ä½“è§‚å¯Ÿè€…ç±»ï¼šå­¦ç”Ÿäº‹ä»¶ç›‘å¬å™¨
class StuEventListener implements BellEventListener {
	public void heardBell(RingEvent e){
		if(e.getSound()){
			System.out.println("åŒå­¦ä»¬ï¼Œä¸Šè¯¾äº†...");
		}else{
			System.out.println("åŒå­¦ä»¬ï¼Œä¸‹è¯¾äº†...");
		}
    }
}
```

```java
import java.util.*;
public class RMBrateTest {
	public static void main(String[] args) {
		Rate rate = new RMBrate();
		Company watcher1 = new ImportCompany();
		Company watcher2 = new ExportCompany();
		rate.add(watcher1);
		rate.add(watcher2);
		rate.change(10);
		rate.change(-9);
	}
}
//æŠ½è±¡ç›®æ ‡ï¼šæ±‡ç‡
abstract class Rate
{
	protected List<Company> companys = new ArrayList<Company>();
	//å¢åŠ è§‚å¯Ÿè€…æ–¹æ³•
	public void add(Company company)
	{
		companys.add(company);
	}
	//åˆ é™¤è§‚å¯Ÿè€…æ–¹æ³•
	public void remove(Company company)
	{
		companys.remove(company);
	}
	public abstract void change(int number);
}
//å…·ä½“ç›®æ ‡ï¼šäººæ°‘å¸æ±‡ç‡
class RMBrate extends Rate
{
    public void change(int number)
	{
		for(Company obs:companys)
		{
			((Company)obs).response(number);
		}
	}

}
//æŠ½è±¡è§‚å¯Ÿè€…ï¼šå…¬å¸
interface Company
{
	void response(int number);
}
//å…·ä½“è§‚å¯Ÿè€…1ï¼šè¿›å£å…¬å¸
class ImportCompany implements Company
{
	public void response(int number)
    {
		if(number > 0){
			System.out.println("äººæ°‘å¸æ±‡ç‡å‡å€¼"+number+"ä¸ªåŸºç‚¹ï¼Œé™ä½äº†è¿›å£äº§å“æˆæœ¬ï¼Œæå‡äº†è¿›å£å…¬å¸åˆ©æ¶¦ç‡ã€‚ " );
        }else if(number < 0){
      	    System.out.println("äººæ°‘å¸æ±‡ç‡è´¬å€¼"+(-number)+"ä¸ªåŸºç‚¹ï¼Œæå‡äº†è¿›å£äº§å“æˆæœ¬ï¼Œé™ä½äº†è¿›å£å…¬å¸åˆ©æ¶¦ç‡ã€‚ " );
        }
    }
}
//å…·ä½“è§‚å¯Ÿè€…2ï¼šå‡ºå£å…¬å¸
class ExportCompany implements Company
{
	public void response(int number)
    {
		if(number > 0){
			System.out.println("äººæ°‘å¸æ±‡ç‡å‡å€¼"+number+"ä¸ªåŸºç‚¹ï¼Œé™ä½äº†å‡ºå£äº§å“æ”¶å…¥ï¼Œé™ä½äº†å‡ºå£å…¬å¸çš„é”€å”®åˆ©æ¶¦ç‡ã€‚ " );
        }else if(number < 0){
      	    System.out.println("äººæ°‘å¸æ±‡ç‡è´¬å€¼"+(-number)+"ä¸ªåŸºç‚¹ï¼Œæå‡äº†å‡ºå£äº§å“æ”¶å…¥ï¼Œæå‡äº†å‡ºå£å…¬å¸çš„é”€å”®åˆ©æ¶¦ç‡ã€‚ " );
        }
    }
}
```

![](/18.png)

## ä¸­ä»‹æ¨¡å¼ ğŸŒŸğŸŒŸ

**å®šä¹‰**

å®šä¹‰ä¸€ä¸ªä¸­ä»‹å¯¹è±¡æ¥å°è£…ä¸€ç³»åˆ—å¯¹è±¡ä¹‹é—´çš„äº¤äº’ï¼Œä½¿åŸæœ‰å¯¹è±¡ä¹‹é—´çš„è€¦åˆæ¾æ•£ï¼Œä¸”å¯ä»¥ç‹¬ç«‹åœ°æ”¹å˜ä»–ä»¬ä¹‹é—´çš„äº¤äº’

**ä¼˜ç¼ºç‚¹**

- ä¼˜ç‚¹ï¼š1ï¼‰é™ä½äº†å¯¹è±¡ä¹‹é—´çš„è€¦åˆæ€§ï¼Œä½¿å¾—å¯¹è±¡æ˜“äºç‹¬ç«‹åœ°è¢«å¤ç”¨ï¼›2ï¼‰å°†å¯¹è±¡é—´çš„ä¸€å¯¹å¤šå…³è”è½¬å˜ä¸ºä¸€å¯¹ä¸€çš„å…³è”ï¼Œæé«˜ç³»ç»Ÿçš„çµæ´»æ€§ï¼Œä½¿å¾—ç³»ç»Ÿæ˜“äºç»´æŠ¤å’Œæ‰©å±•ã€‚

- ç¼ºç‚¹ï¼šå½“åŒäº‹ç±»å¤ªå¤šæ—¶ï¼Œä¸­ä»‹è€…çš„èŒè´£å°†å¾ˆå¤§ï¼Œå®ƒä¼šå˜å¾—å¤æ‚è€Œåºå¤§ï¼Œä»¥è‡³äºç³»ç»Ÿéš¾ä»¥ç»´æŠ¤

**ç¤ºä¾‹**

```java
import java.util.*;
public class SimpleMediatorPattern {
	public static void main(String[] args) {
		SimpleColleague c1,c2;
		c1=new SimpleConcreteColleague1();
		c2=new SimpleConcreteColleague2();
		c1.send();
		System.out.println("-----------------");
		c2.send();
	}
}
//ç®€å•å•ä¾‹ä¸­ä»‹è€…
class SimpleMediator
{
	private static SimpleMediator smd=new SimpleMediator();
	private List<SimpleColleague> colleagues=new ArrayList<SimpleColleague>();
	private SimpleMediator(){}
	public static SimpleMediator getMedium()
    {	return(smd);   }
	public void register(SimpleColleague colleague)
	{
		if(!colleagues.contains(colleague))
		{
			colleagues.add(colleague);
		}
	}
	public void relay(SimpleColleague scl)
	{
		for(SimpleColleague ob:colleagues)
		{
			if(!ob.equals(scl))
    		{
				((SimpleColleague)ob).receive();
    		}
		}
	}
}
//æŠ½è±¡åŒäº‹ç±»
interface SimpleColleague
{
	void receive();
	void send();
}
//å…·ä½“åŒäº‹ç±»
class SimpleConcreteColleague1 implements SimpleColleague
{
	SimpleConcreteColleague1(){
		SimpleMediator smd=SimpleMediator.getMedium();
		smd.register(this);
	}
	public void receive()
	{	System.out.println("å…·ä½“åŒäº‹ç±»1ï¼šæ”¶åˆ°è¯·æ±‚ã€‚");	}
	public void send()
	{
		SimpleMediator smd=SimpleMediator.getMedium();
		System.out.println("å…·ä½“åŒäº‹ç±»1ï¼šå‘å‡ºè¯·æ±‚...");
		smd.relay(this); //è¯·ä¸­ä»‹è€…è½¬å‘
	}
}
//å…·ä½“åŒäº‹ç±»
class SimpleConcreteColleague2 implements SimpleColleague
{
	SimpleConcreteColleague2(){
		SimpleMediator smd=SimpleMediator.getMedium();
		smd.register(this);
	}
	public void receive()
	{	System.out.println("å…·ä½“åŒäº‹ç±»2ï¼šæ”¶åˆ°è¯·æ±‚ã€‚");	}
	public void send()
	{
		SimpleMediator smd=SimpleMediator.getMedium();
		System.out.println("å…·ä½“åŒäº‹ç±»2ï¼šå‘å‡ºè¯·æ±‚...");
		smd.relay(this); //è¯·ä¸­ä»‹è€…è½¬å‘
	}
}
```

```java
import java.util.*;
public class MediatorPattern {
	public static void main(String[] args) {
		Mediator md=new ConcreteMediator();
		Colleague c1,c2;
		c1=new ConcreteColleague1();
		c2=new ConcreteColleague2();
		md.register(c1);
		md.register(c2);
		c1.send();
		System.out.println("-------------");
		c2.send();
	}
}
//æŠ½è±¡ä¸­ä»‹è€…
abstract class Mediator
{
	public abstract void register(Colleague colleague);
	public abstract void relay(Colleague cl); //è½¬å‘
}
//å…·ä½“ä¸­ä»‹è€…
class ConcreteMediator extends Mediator
{
	private List<Colleague> colleagues=new ArrayList<Colleague>();
	public void register(Colleague colleague)
	{
		if(!colleagues.contains(colleague))
		{
			colleagues.add(colleague);
			colleague.setMedium(this);
		}
	}
	public void relay(Colleague cl)
	{
		for(Colleague ob:colleagues)
		{
			if(!ob.equals(cl))
    		{
				((Colleague)ob).receive();
    		}
		}
	}
}
//æŠ½è±¡åŒäº‹ç±»
abstract class Colleague
{
	protected Mediator mediator;
	public void setMedium(Mediator mediator)
    {
		this.mediator=mediator;
	}
	public abstract void receive();
	public abstract void send();
}
//å…·ä½“åŒäº‹ç±»
class ConcreteColleague1 extends Colleague
{
	public void receive()
	{
		System.out.println("å…·ä½“åŒäº‹ç±»1æ”¶åˆ°è¯·æ±‚ã€‚");
	}
	public void send()
	{
		System.out.println("å…·ä½“åŒäº‹ç±»1å‘å‡ºè¯·æ±‚ã€‚");
		mediator.relay(this); //è¯·ä¸­ä»‹è€…è½¬å‘
	}
}
//å…·ä½“åŒäº‹ç±»
class ConcreteColleague2 extends Colleague
{
	public void receive()
	{
		System.out.println("å…·ä½“åŒäº‹ç±»2æ”¶åˆ°è¯·æ±‚ã€‚");
	}
	public void send()
	{
		System.out.println("å…·ä½“åŒäº‹ç±»2å‘å‡ºè¯·æ±‚ã€‚");
		mediator.relay(this); //è¯·ä¸­ä»‹è€…è½¬å‘
	}
}
```

![](/19.png)

## è¿­ä»£å™¨æ¨¡å¼ ğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸ

**å®šä¹‰**

æä¾›ä¸€ä¸ªå¯¹è±¡æ¥é¡ºåºè®¿é—®èšåˆå¯¹è±¡ä¸­çš„ä¸€ç³»åˆ—æ•°æ®ï¼Œè€Œä¸æš´éœ²èšåˆå¯¹è±¡çš„å†…éƒ¨è¡¨ç¤º

**ä¼˜ç¼ºç‚¹**

- ä¼˜ç‚¹ï¼š1ï¼‰è®¿é—®ä¸€ä¸ªèšåˆå¯¹è±¡çš„å†…å®¹è€Œæ— éœ€æš´éœ²å®ƒçš„å†…éƒ¨è¡¨ç¤ºï¼›2ï¼‰éå†ä»»åŠ¡äº¤ç”±è¿­ä»£å™¨å®Œæˆï¼Œè¿™ç®€åŒ–äº†èšåˆç±»ï¼›3ï¼‰å®ƒæ”¯æŒä»¥ä¸åŒæ–¹å¼éå†ä¸€ä¸ªèšåˆï¼Œç”šè‡³å¯ä»¥è‡ªå®šä¹‰è¿­ä»£å™¨çš„å­ç±»ä»¥æ”¯æŒæ–°çš„éå†ï¼›4ï¼‰å¢åŠ æ–°çš„èšåˆç±»å’Œè¿­ä»£å™¨ç±»éƒ½å¾ˆæ–¹ä¾¿ï¼Œæ— é¡»ä¿®æ”¹åŸæœ‰ä»£ç ï¼›5ï¼‰å°è£…æ€§è‰¯å¥½ï¼Œä¸ºéå†ä¸åŒçš„èšåˆç»“æ„æä¾›ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£ã€‚

- ç¼ºç‚¹ï¼šå¢åŠ äº†ç±»çš„ä¸ªæ•°ï¼Œè¿™åœ¨ä¸€å®šç¨‹åº¦ä¸Šå¢åŠ äº†ç³»ç»Ÿçš„å¤æ‚æ€§ã€‚

**ç¤ºä¾‹**

```java
import java.util.*;
public class IteratorPattern {
	public static void main(String[] args) {
		Aggregate ag = new ConcreteAggregate();
        ag.add("ä¸­å±±å¤§å­¦");
        ag.add("åå—ç†å·¥");
        ag.add("éŸ¶å…³å­¦é™¢");
        System.out.print("èšåˆçš„å†…å®¹æœ‰ï¼š");
        Iterator it = ag.getIterator();
        while(it.hasNext()){
        	Object ob = it.next();
            System.out.print(ob.toString()+"\t");
        }
        Object ob = it.first();
        System.out.println("\nFirstï¼š"+ob.toString());
	}
}
//æŠ½è±¡èšåˆ
interface Aggregate {
    public void add(Object obj);
    public void remove(Object obj);
    public Iterator getIterator();
}
//å…·ä½“èšåˆ
class ConcreteAggregate implements Aggregate {
    private List<Object> list = new ArrayList<Object>();
    public void add(Object obj) {
        list.add(obj);
    }
    public void remove(Object obj) {
        list.remove(obj);
    }
    public Iterator getIterator() {
        return(new ConcreteIterator(list));
    }
}
//æŠ½è±¡è¿­ä»£å™¨
interface Iterator {
	Object first();
    Object next();
    boolean hasNext();
}
//å…·ä½“è¿­ä»£å™¨
class ConcreteIterator implements Iterator{
    private List<Object> list = null;
    private int index =-1;
    public ConcreteIterator(List<Object> list){
        this.list = list;
    }
    public boolean hasNext() {
    	if(index<list.size()-1){
            return true;
        } else {
        	return false;
        }
    }
    public Object first(){
    	index=0;
    	Object obj = list.get(index);;
		return obj;
    }
    public Object next() {
        Object obj = null;
        if(this.hasNext()){
            obj = list.get(++index);
        }
        return obj;
    }
}
```

![](/20.png)

## è®¿é—®è€…æ¨¡å¼ ğŸŒŸ

**å®šä¹‰**

å°†ä½œç”¨äºæŸç§æ•°æ®ç»“æ„ä¸­çš„å„å…ƒç´ çš„æ“ä½œåˆ†ç¦»å‡ºæ¥å°è£…æˆç‹¬ç«‹çš„ç±»ï¼Œä½¿å…¶åœ¨ä¸æ”¹å˜æ•°æ®ç»“æ„çš„å‰æä¸‹å¯ä»¥æ·»åŠ ä½œç”¨äºè¿™äº›å…ƒç´ çš„æ–°çš„æ“ä½œï¼Œä¸ºæ•°æ®ç»“æ„ä¸­çš„æ¯ä¸ªå…ƒç´ æä¾›å¤šç§è®¿é—®æ–¹å¼ã€‚

**ä¼˜ç¼ºç‚¹**

- ä¼˜ç‚¹ï¼š1ï¼‰æ‰©å±•æ€§å¥½ã€‚èƒ½å¤Ÿåœ¨ä¸ä¿®æ”¹å¯¹è±¡ç»“æ„ä¸­çš„å…ƒç´ çš„æƒ…å†µä¸‹ï¼Œä¸ºå¯¹è±¡ç»“æ„ä¸­çš„å…ƒç´ æ·»åŠ æ–°çš„åŠŸèƒ½ï¼›2ï¼‰å¤ç”¨æ€§å¥½ã€‚å¯ä»¥é€šè¿‡è®¿é—®è€…æ¥å®šä¹‰æ•´ä¸ªå¯¹è±¡ç»“æ„é€šç”¨çš„åŠŸèƒ½ï¼Œä»è€Œæé«˜ç³»ç»Ÿçš„å¤ç”¨ç¨‹åº¦ï¼›3ï¼‰çµæ´»æ€§å¥½ã€‚è®¿é—®è€…æ¨¡å¼å°†æ•°æ®ç»“æ„ä¸ä½œç”¨äºç»“æ„ä¸Šçš„æ“ä½œè§£è€¦ï¼Œä½¿å¾—æ“ä½œé›†åˆå¯ç›¸å¯¹è‡ªç”±åœ°æ¼”åŒ–è€Œä¸å½±å“ç³»ç»Ÿçš„æ•°æ®ç»“æ„ï¼›4ï¼‰ç¬¦åˆå•ä¸€èŒè´£åŸåˆ™ã€‚è®¿é—®è€…æ¨¡å¼æŠŠç›¸å…³çš„è¡Œä¸ºå°è£…åœ¨ä¸€èµ·ï¼Œæ„æˆä¸€ä¸ªè®¿é—®è€…ï¼Œä½¿æ¯ä¸€ä¸ªè®¿é—®è€…çš„åŠŸèƒ½éƒ½æ¯”è¾ƒå•ä¸€ã€‚

- ç¼ºç‚¹ï¼š1ï¼‰å¢åŠ æ–°çš„å…ƒç´ ç±»å¾ˆå›°éš¾ã€‚åœ¨è®¿é—®è€…æ¨¡å¼ä¸­ï¼Œæ¯å¢åŠ ä¸€ä¸ªæ–°çš„å…ƒç´ ç±»ï¼Œéƒ½è¦åœ¨æ¯ä¸€ä¸ªå…·ä½“è®¿é—®è€…ç±»ä¸­å¢åŠ ç›¸åº”çš„å…·ä½“æ“ä½œï¼Œ**è¿™è¿èƒŒäº†â€œå¼€é—­åŸåˆ™â€**ï¼› 2ï¼‰ç ´åå°è£…ã€‚è®¿é—®è€…æ¨¡å¼ä¸­å…·ä½“å…ƒç´ å¯¹è®¿é—®è€…å…¬å¸ƒç»†èŠ‚ï¼Œè¿™ç ´åäº†å¯¹è±¡çš„å°è£…æ€§ï¼›3ï¼‰**è¿åäº†ä¾èµ–å€’ç½®åŸåˆ™**ã€‚è®¿é—®è€…æ¨¡å¼ä¾èµ–äº†å…·ä½“ç±»ï¼Œè€Œæ²¡æœ‰ä¾èµ–æŠ½è±¡ç±»

**ç¤ºä¾‹**

```java
import java.util.*;
public class VisitorPattern {
	public static void main(String[] args) {
		ObjectStructure os = new ObjectStructure();
        os.add(new ConcreteElementA());
        os.add(new ConcreteElementB());
        Visitor visitor = new ConcreteVisitorA();
        os.accept(visitor);
        System.out.println("------------------------");
        visitor = new ConcreteVisitorB();
        os.accept(visitor);
	}
}
//æŠ½è±¡è®¿é—®è€…
interface Visitor {
    void visit(ConcreteElementA element);
    void visit(ConcreteElementB element);
}
//å…·ä½“è®¿é—®è€…Aç±»
class ConcreteVisitorA implements Visitor {
	public void visit(ConcreteElementA element) {
		System.out.println("å…·ä½“è®¿é—®è€…Aè®¿é—®-->"+element.operationA());
    }
    public void visit(ConcreteElementB element) {
        System.out.println("å…·ä½“è®¿é—®è€…Aè®¿é—®-->"+element.operationB());
    }
}
//å…·ä½“è®¿é—®è€…Bç±»
class ConcreteVisitorB implements Visitor {
    public void visit(ConcreteElementA element) {
        System.out.println("å…·ä½“è®¿é—®è€…Bè®¿é—®-->"+element.operationA());
    }
    public void visit(ConcreteElementB element) {
        System.out.println("å…·ä½“è®¿é—®è€…Bè®¿é—®-->"+element.operationB());
    }
}
//æŠ½è±¡å…ƒç´ ç±»
interface Element {
    void accept(Visitor visitor);
}
//å…·ä½“å…ƒç´ Aç±»
class ConcreteElementA implements Element{
	public void accept(Visitor visitor) {
		visitor.visit(this);
    }
    public String operationA(){
        return "å…·ä½“å…ƒç´ Açš„æ“ä½œã€‚";
    }
}
//å…·ä½“å…ƒç´ Bç±»
class ConcreteElementB implements Element{
    public void accept(Visitor visitor) {
        visitor.visit(this);
    }
    public String operationB(){
        return "å…·ä½“å…ƒç´ Bçš„æ“ä½œã€‚";
    }
}
//å¯¹è±¡ç»“æ„è§’è‰²
class ObjectStructure {
    private List<Element> list = new ArrayList<Element>();
    public void accept(Visitor visitor){
    	Iterator<Element> i=list.iterator();
        while(i.hasNext())
        {
        	((Element) i.next()).accept(visitor);
        }
    }
    public void add(Element element){
    	list.add(element);
    }
    public void remove(Element element){
    	list.remove(element);
    }
}
```

![](/21.png)

## å¤‡å¿˜å½•æ¨¡å¼ ğŸŒŸğŸŒŸ

**å®šä¹‰**

åœ¨ä¸ç ´åå°è£…æ€§çš„å‰æä¸‹ï¼Œæ•è·ä¸€ä¸ªå¯¹è±¡çš„å†…éƒ¨çŠ¶æ€ï¼Œå¹¶åœ¨è¯¥å¯¹è±¡ä¹‹å¤–ä¿å­˜è¿™ä¸ªçŠ¶æ€ï¼Œä»¥ä¾¿ä»¥åå½“éœ€è¦æ—¶èƒ½å°†è¯¥å¯¹è±¡æ¢å¤åˆ°åŸå…ˆä¿å­˜çš„çŠ¶æ€ã€‚

**ä¼˜ç¼ºç‚¹**

- ä¼˜ç‚¹ï¼š1ï¼‰æä¾›äº†ä¸€ç§å¯ä»¥æ¢å¤çŠ¶æ€çš„æœºåˆ¶ã€‚ç”¨æˆ·å½“éœ€è¦æ—¶èƒ½å¤Ÿæ¯”è¾ƒæ–¹ä¾¿åœ°å°†æ•°æ®æ¢å¤åˆ°æŸä¸ªå†å²çš„çŠ¶æ€ï¼›2ï¼‰å®ç°äº†å†…éƒ¨çŠ¶æ€çš„å°è£…ã€‚é™¤äº†åˆ›å»ºå®ƒçš„å‘èµ·äººä¹‹å¤–å…¶ä»–å¯¹è±¡éƒ½ä¸èƒ½å¤Ÿè®¿é—®è¿™äº›çŠ¶æ€ä¿¡æ¯ï¼›3ï¼‰ç®€åŒ–äº†å‘èµ·äººç±»ã€‚å‘èµ·äººä¸éœ€è¦ç®¡ç†å’Œä¿å­˜å…¶å†…éƒ¨çŠ¶æ€çš„å„ä¸ªå¤‡ä»½ï¼Œæ‰€æœ‰çŠ¶æ€ä¿¡æ¯éƒ½ä¿å­˜åœ¨å¤‡å¿˜å½•ä¸­ï¼Œå¹¶ç”±ç®¡ç†è€…è¿›è¡Œç®¡ç†ï¼Œè¿™ç¬¦åˆå•ä¸€èŒè´£åŸåˆ™ã€‚

- ç¼ºç‚¹ï¼šèµ„æºæ¶ˆè€—å¤§ã€‚å¦‚æœè¦ä¿å­˜çš„å†…éƒ¨çŠ¶æ€ä¿¡æ¯è¿‡å¤šæˆ–è€…ç‰¹åˆ«é¢‘ç¹ï¼Œå°†ä¼šå ç”¨æ¯”è¾ƒå¤§çš„å†…å­˜èµ„æºã€‚

**ç¤ºä¾‹**

```java
public class MementoPattern {
	public static void main(String[] args) {
		Originator or = new Originator();
		Caretaker cr = new Caretaker();
        or.setState("S0");
        System.out.println("åˆå§‹çŠ¶æ€:"+or.getState());
        cr.setMemento(or.createMemento()); //ä¿å­˜çŠ¶æ€
        or.setState("S1");
        System.out.println("æ–°çš„çŠ¶æ€:"+or.getState());
        or.restoreMemento(cr.getMemento()); //æ¢å¤çŠ¶æ€
        System.out.println("æ¢å¤çŠ¶æ€:"+or.getState());
	}
}
//å¤‡å¿˜å½•
class Memento {
    private String state;
    public Memento(String state){
        this.state = state;
    }
    public void setState(String state) {
        this.state = state;
    }
    public String getState() {
        return state;
    }
}
//å‘èµ·äºº
class Originator {
    private String state;
    public void setState(String state) {
        this.state = state;
    }
    public String getState() {
        return state;
    }
    public Memento createMemento(){
        return new Memento(state);
    }
    public void restoreMemento(Memento m){
        this.setState(m.getState());
    }
}
//ç®¡ç†è€…
class Caretaker {
    private Memento memento;
    public void setMemento(Memento m){
        memento = m;
    }
    public Memento getMemento(){
        return memento;
    }
}
```

![](/22.png)

## è§£é‡Šå™¨æ¨¡å¼ ğŸŒŸ

**å®šä¹‰**

ç»™åˆ†æå¯¹è±¡å®šä¹‰ä¸€ä¸ªè¯­è¨€ï¼Œå¹¶å®šä¹‰è¯¥è¯­è¨€çš„æ–‡æ³•è¡¨ç¤ºï¼Œå†è®¾è®¡ä¸€ä¸ªè§£æå™¨æ¥è§£é‡Šè¯­è¨€ä¸­çš„å¥å­ã€‚ä¹Ÿå°±è¯´ï¼Œç”¨ç¼–è¯‘è¯­è¨€çš„æ–¹å¼æ¥åˆ†æåº”ç”¨ä¸­çš„å®ä¾‹

**ä¼˜ç¼ºç‚¹**

- ä¼˜ç‚¹ï¼š1ï¼‰æ‰©å±•æ€§å¥½ã€‚ç”±äºåœ¨è§£é‡Šå™¨æ¨¡å¼ä¸­ä½¿ç”¨ç±»æ¥è¡¨ç¤ºè¯­è¨€çš„æ–‡æ³•è§„åˆ™ï¼Œå› æ­¤å¯ä»¥é€šè¿‡ç»§æ‰¿ç­‰æœºåˆ¶æ¥æ”¹å˜æˆ–æ‰©å±•æ–‡æ³•ï¼›2ï¼‰å®¹æ˜“å®ç°ã€‚åœ¨è¯­æ³•æ ‘ä¸­çš„æ¯ä¸ªè¡¨è¾¾å¼èŠ‚ç‚¹ç±»éƒ½æ˜¯ç›¸ä¼¼çš„ï¼Œæ‰€ä»¥å®ç°å…¶æ–‡æ³•è¾ƒä¸ºå®¹æ˜“ã€‚

- ç¼ºç‚¹ï¼š1ï¼‰æ‰§è¡Œæ•ˆç‡è¾ƒä½ã€‚è§£é‡Šå™¨æ¨¡å¼ä¸­é€šå¸¸ä½¿ç”¨å¤§é‡çš„å¾ªç¯å’Œé€’å½’è°ƒç”¨ï¼Œå½“è¦è§£é‡Šçš„å¥å­è¾ƒå¤æ‚æ—¶ï¼Œå…¶è¿è¡Œé€Ÿåº¦å¾ˆæ…¢ï¼Œä¸”ä»£ç çš„è°ƒè¯•è¿‡ç¨‹ä¹Ÿæ¯”è¾ƒéº»çƒ¦ï¼›2ï¼‰ä¼šå¼•èµ·ç±»è†¨èƒ€ã€‚è§£é‡Šå™¨æ¨¡å¼ä¸­çš„æ¯æ¡è§„åˆ™è‡³å°‘éœ€è¦å®šä¹‰ä¸€ä¸ªç±»ï¼Œå½“åŒ…å«çš„æ–‡æ³•è§„åˆ™å¾ˆå¤šæ—¶ï¼Œç±»çš„ä¸ªæ•°å°†æ€¥å‰§å¢åŠ ï¼Œå¯¼è‡´ç³»ç»Ÿéš¾ä»¥ç®¡ç†ä¸ç»´æŠ¤ï¼›3ï¼‰å¯åº”ç”¨çš„åœºæ™¯æ¯”è¾ƒå°‘ã€‚åœ¨è½¯ä»¶å¼€å‘ä¸­ï¼Œéœ€è¦å®šä¹‰è¯­è¨€æ–‡æ³•çš„åº”ç”¨å®ä¾‹éå¸¸å°‘ï¼Œæ‰€ä»¥è¿™ç§æ¨¡å¼å¾ˆå°‘è¢«ä½¿ç”¨åˆ°ã€‚

**ç¤ºä¾‹**

```java
import java.util.*;
/*æ–‡æ³•è§„åˆ™
  <expression> ::= <city>çš„<person>
  <city> ::= éŸ¶å…³ | å¹¿å·
  <person> ::= è€äºº | å¦‡å¥³ | å„¿ç«¥
*/
public class InterpreterPatternDemo {
	public static void main(String[] args) {
		Context bus=new Context();
		bus.freeRide("éŸ¶å…³çš„è€äºº");
		bus.freeRide("éŸ¶å…³çš„å¹´è½»äºº");
		bus.freeRide("å¹¿å·çš„å¦‡å¥³");
		bus.freeRide("å¹¿å·çš„å„¿ç«¥");
		bus.freeRide("å±±ä¸œçš„å„¿ç«¥");
	}
}
//æŠ½è±¡è¡¨è¾¾å¼ç±»
interface Expression {
	public boolean interpret(String info);
}
//ç»ˆç»“ç¬¦è¡¨è¾¾å¼ç±»
class TerminalExpression implements Expression {
	private Set<String> set= new HashSet<String>();
    public TerminalExpression(String[] data){
    	for(int i=0;i<data.length;i++)set.add(data[i]);
    }
    public boolean interpret(String info) {
    	if(set.contains(info)){
    		return true;
        }
        return false;
    }
}
//éç»ˆç»“ç¬¦è¡¨è¾¾å¼ç±»
class AndExpression implements Expression {
	private Expression city = null;
    private Expression person = null;
    public AndExpression(Expression city,Expression person) {
    	this.city = city;
        this.person = person;
    }
    public boolean interpret(String info) {
    	String s[]=info.split("çš„");
        return city.interpret(s[0])&&person.interpret(s[1]);
    }
}
//ç¯å¢ƒç±»
class Context{
	private String[] citys={"éŸ¶å…³","å¹¿å·"};
	private String[] persons={"è€äºº","å¦‡å¥³","å„¿ç«¥"};
	private Expression cityPerson;
    public Context(){
    	Expression city=new TerminalExpression(citys);
        Expression person=new TerminalExpression(persons);
        cityPerson=new AndExpression(city,person);
    }
    public void freeRide(String info) {
    	boolean ok=cityPerson.interpret(info);
	    if(ok) System.out.println("æ‚¨æ˜¯"+info+"ï¼Œæ‚¨æœ¬æ¬¡ä¹˜è½¦å…è´¹ï¼");
	    else System.out.println(info+"ï¼Œæ‚¨ä¸æ˜¯å…è´¹äººå‘˜ï¼Œæœ¬æ¬¡ä¹˜è½¦æ‰£è´¹2å…ƒï¼");
    }
}

```

![](/23.png)
