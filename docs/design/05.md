# è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼(ä¸Š)

## æ¨¡æ¿æ¨¡å¼ ğŸŒŸğŸŒŸğŸŒŸ

**å®šä¹‰**

å®šä¹‰ä¸€ä¸ªæ“ä½œä¸­çš„ç®—æ³•éª¨æ¶ï¼Œè€Œå°†ç®—æ³•çš„ä¸€äº›æ­¥éª¤å»¶è¿Ÿåˆ°å­ç±»ä¸­ï¼Œä½¿å¾—å­ç±»å¯ä»¥ä¸æ”¹å˜è¯¥ç®—æ³•ç»“æ„çš„æƒ…å†µä¸‹é‡å®šä¹‰è¯¥ç®—æ³•çš„æŸäº›ç‰¹å®šæ­¥éª¤ã€‚

**ä¼˜ç¼ºç‚¹**

- ä¼˜ç‚¹ï¼š1ï¼‰å®ƒå°è£…äº†ä¸å˜éƒ¨åˆ†ï¼Œæ‰©å±•å¯å˜éƒ¨åˆ†ã€‚å®ƒæŠŠè®¤ä¸ºæ˜¯ä¸å˜éƒ¨åˆ†çš„ç®—æ³•å°è£…åˆ°çˆ¶ç±»ä¸­å®ç°ï¼Œè€ŒæŠŠå¯å˜éƒ¨åˆ†ç®—æ³•ç”±å­ç±»ç»§æ‰¿å®ç°ï¼Œä¾¿äºå­ç±»ç»§ç»­æ‰©å±•ï¼›2ï¼‰å®ƒåœ¨çˆ¶ç±»ä¸­æå–äº†å…¬å…±çš„éƒ¨åˆ†ä»£ç ï¼Œä¾¿äºä»£ç å¤ç”¨ï¼›3ï¼‰éƒ¨åˆ†æ–¹æ³•æ˜¯ç”±å­ç±»å®ç°çš„ï¼Œå› æ­¤å­ç±»å¯ä»¥é€šè¿‡æ‰©å±•æ–¹å¼å¢åŠ ç›¸åº”çš„åŠŸèƒ½ï¼Œ**ç¬¦åˆå¼€é—­åŸåˆ™**ã€‚

- ç¼ºç‚¹ï¼š1ï¼‰å¯¹æ¯ä¸ªä¸åŒçš„å®ç°éƒ½éœ€è¦å®šä¹‰ä¸€ä¸ªå­ç±»ï¼Œè¿™ä¼šå¯¼è‡´ç±»çš„ä¸ªæ•°å¢åŠ ï¼Œç³»ç»Ÿæ›´åŠ åºå¤§ï¼Œè®¾è®¡ä¹Ÿæ›´åŠ æŠ½è±¡ï¼›2ï¼‰çˆ¶ç±»ä¸­çš„æŠ½è±¡æ–¹æ³•ç”±å­ç±»å®ç°ï¼Œå­ç±»æ‰§è¡Œçš„ç»“æœä¼šå½±å“çˆ¶ç±»çš„ç»“æœï¼Œè¿™å¯¼è‡´ä¸€ç§åå‘çš„æ§åˆ¶ç»“æ„ï¼Œå®ƒæé«˜äº†ä»£ç é˜…è¯»çš„éš¾åº¦

**ç¤ºä¾‹**

```java
public class TemplateMethodPattern {
	public static void main(String[] args) {
		AbstractClass tm=new ConcreteClass();
		tm.TemplateMethod();
	}
}
//æŠ½è±¡ç±»
abstract class AbstractClass
{
    public void TemplateMethod() //æ¨¡æ¿æ–¹æ³•
    {
    	SpecificMethod();
        abstractMethod1();
 	    abstractMethod2();
    }
	public void SpecificMethod() //å…·ä½“æ–¹æ³•
	{
		System.out.println("æŠ½è±¡ç±»ä¸­çš„å…·ä½“æ–¹æ³•è¢«è°ƒç”¨...");
	}
	public abstract void abstractMethod1(); //æŠ½è±¡æ–¹æ³•1
	public abstract void abstractMethod2(); //æŠ½è±¡æ–¹æ³•2
}
//å…·ä½“å­ç±»
class ConcreteClass extends AbstractClass
{
	public void abstractMethod1()
	{
		System.out.println("æŠ½è±¡æ–¹æ³•1çš„å®ç°è¢«è°ƒç”¨...");
	}
	public void abstractMethod2()
	{
		System.out.println("æŠ½è±¡æ–¹æ³•2çš„å®ç°è¢«è°ƒç”¨...");
	}
}
```

```java
public class StudyAbroadProcess {
	public static void main(String[] args) {
		StudyAbroad tm=new StudyInAmerica();
		tm.TemplateMethod();
	}
}
//æŠ½è±¡ç±»: å‡ºå›½ç•™å­¦
abstract class StudyAbroad
{
	public void TemplateMethod() //æ¨¡æ¿æ–¹æ³•
    {
		LookingForSchool(); //ç´¢å–å­¦æ ¡èµ„æ–™
		ApplyForEnrol();    //å…¥å­¦ç”³è¯·
		ApplyForPassport(); //åŠç†å› ç§å‡ºå›½æŠ¤ç…§ã€å‡ºå¢ƒå¡å’Œå…¬è¯
		ApplyForVisa();     //ç”³è¯·ç­¾è¯
		ReadyGoAbroad();    //ä½“æ£€ã€è®¢æœºç¥¨ã€å‡†å¤‡è¡Œè£…
		Arriving();         //æŠµè¾¾
    }
	public void ApplyForPassport()
	{
		System.out.println("ä¸‰.åŠç†å› ç§å‡ºå›½æŠ¤ç…§ã€å‡ºå¢ƒå¡å’Œå…¬è¯ï¼š");
		System.out.println("  1ï¼‰æŒå½•å–é€šçŸ¥ä¹¦ã€æœ¬äººæˆ·å£ç°¿æˆ–èº«ä»½è¯å‘æˆ·å£æ‰€åœ¨åœ°å…¬å®‰æœºå…³ç”³è¯·åŠç†å› ç§å‡ºå›½æŠ¤ç…§å’Œå‡ºå¢ƒå¡ã€‚");
		System.out.println("  2ï¼‰åŠç†å‡ºç”Ÿå…¬è¯ä¹¦ï¼Œå­¦å†ã€å­¦ä½å’Œæˆç»©å…¬è¯ï¼Œç»å†è¯ä¹¦ï¼Œäº²å±å…³ç³»å…¬è¯ï¼Œç»æµæ‹…ä¿å…¬è¯ã€‚");
	}
	public void ApplyForVisa()
	{
		System.out.println("å››.ç”³è¯·ç­¾è¯ï¼š");
		System.out.println("  1ï¼‰å‡†å¤‡ç”³è¯·å›½å¤–å¢ƒç­¾è¯æ‰€éœ€çš„å„ç§èµ„æ–™ï¼ŒåŒ…æ‹¬ä¸ªäººå­¦å†ã€æˆç»©å•ã€å·¥ä½œç»å†çš„è¯æ˜ï¼›ä¸ªäººåŠå®¶åº­æ”¶å…¥ã€èµ„é‡‘å’Œè´¢äº§è¯æ˜ï¼›å®¶åº­æˆå‘˜çš„å…³ç³»è¯æ˜ç­‰ï¼›");
		System.out.println("  2ï¼‰å‘æ‹Ÿç•™å­¦å›½å®¶é©»åä½¿(é¢†)é¦†ç”³è¯·å…¥å¢ƒç­¾è¯ã€‚ç”³è¯·æ—¶éœ€æŒ‰è¦æ±‚å¡«å†™æœ‰å…³è¡¨æ ¼ï¼Œé€’äº¤å¿…éœ€çš„è¯æ˜ææ–™ï¼Œç¼´çº³ç­¾è¯ã€‚æœ‰çš„å›½å®¶(æ¯”å¦‚ç¾å›½ã€è‹±å›½ã€åŠ æ‹¿å¤§ç­‰)åœ¨ç”³è¯·ç­¾è¯æ—¶ä¼šè¦æ±‚ç”³è¯·äººå‰å¾€ä½¿(é¢†)é¦†è¿›è¡Œé¢è¯•ã€‚");
	}
	public void ReadyGoAbroad()
	{
		System.out.println("äº”.ä½“æ£€ã€è®¢æœºç¥¨ã€å‡†å¤‡è¡Œè£…ï¼š");
		System.out.println("  1ï¼‰è¿›è¡Œèº«ä½“æ£€æŸ¥ã€å…ç–«æ£€æŸ¥å’Œæ¥ç§ä¼ æŸ“ç—…ç–«è‹—ï¼›");
		System.out.println("  2ï¼‰ç¡®å®šæœºç¥¨æ—¶é—´ã€èˆªç­å’Œè½¬æœºåœ°ç‚¹ã€‚");
	}
	public abstract void LookingForSchool();//ç´¢å–å­¦æ ¡èµ„æ–™
	public abstract void ApplyForEnrol();   //å…¥å­¦ç”³è¯·
	public abstract void Arriving();        //æŠµè¾¾
}
//å…·ä½“å­ç±»: ç¾å›½ç•™å­¦
class StudyInAmerica extends StudyAbroad
{
	@Override
	public void LookingForSchool() {
		System.out.println("ä¸€.ç´¢å–å­¦æ ¡ä»¥ä¸‹èµ„æ–™ï¼š");
		System.out.println("  1ï¼‰å¯¹ç•™å­¦æ„å‘å›½å®¶çš„æ”¿æ²»ã€ç»æµã€æ–‡åŒ–èƒŒæ™¯å’Œæ•™è‚²ä½“åˆ¶ã€å­¦æœ¯æ°´å¹³è¿›è¡Œè¾ƒä¸ºå…¨é¢çš„äº†è§£ï¼›");
		System.out.println("  2ï¼‰å…¨é¢äº†è§£å’ŒæŒæ¡å›½å¤–å­¦æ ¡çš„æƒ…å†µï¼ŒåŒ…æ‹¬å†å²ã€å­¦è´¹ã€å­¦åˆ¶ã€ä¸“ä¸šã€å¸ˆèµ„é…å¤‡ã€æ•™å­¦è®¾æ–½ã€å­¦æœ¯åœ°ä½ã€å­¦ç”Ÿäººæ•°ç­‰ï¼›");
		System.out.println("  3ï¼‰äº†è§£è¯¥å­¦æ ¡çš„ä½å®¿ã€äº¤é€šã€åŒ»ç–—ä¿é™©æƒ…å†µå¦‚ä½•ï¼›");
		System.out.println("  4ï¼‰è¯¥å­¦æ ¡åœ¨ä¸­å›½æ˜¯å¦æœ‰æˆæƒä»£ç†æ‹›ç”Ÿçš„ç•™å­¦ä¸­ä»‹å…¬å¸ï¼Ÿ");
		System.out.println("  5ï¼‰æŒæ¡ç•™å­¦ç­¾è¯æƒ…å†µï¼›");
		System.out.println("  6ï¼‰è¯¥å›½æ”¿åºœæ˜¯å¦å…è®¸ç•™å­¦ç”Ÿåˆæ³•æ‰“å·¥ï¼Ÿ");
		System.out.println("  8ï¼‰æ¯•ä¸šä¹‹åå¯å¦ç§»æ°‘ï¼Ÿ");
		System.out.println("  9ï¼‰æ–‡å‡­æ˜¯å¦å—åˆ°æˆ‘å›½è®¤å¯ï¼Ÿ");
	}
	@Override
	public void ApplyForEnrol() {
		System.out.println("äºŒ.å…¥å­¦ç”³è¯·ï¼š");
		System.out.println("  1ï¼‰å¡«å†™æŠ¥åè¡¨ï¼›");
		System.out.println("  2ï¼‰å°†æŠ¥åè¡¨ã€ä¸ªäººå­¦å†è¯æ˜ã€æœ€è¿‘çš„å­¦ä¹ æˆç»©å•ã€æ¨èä¿¡ã€ä¸ªäººç®€å†ã€æ‰˜ç¦æˆ–é›…æ€è¯­è¨€è€ƒè¯•æˆç»©å•ç­‰èµ„æ–™å¯„å¾€æ‰€ç”³è¯·çš„å­¦æ ¡ï¼›");
		System.out.println("  3ï¼‰ä¸ºäº†ç»™ç­¾è¯åŠç†ç•™æœ‰å……è£•çš„æ—¶é—´ï¼Œå»ºè®®è¶Šæ—©ç”³è¯·è¶Šå¥½ï¼Œä¸€èˆ¬æå‰1å¹´å°±æ¯”è¾ƒä»å®¹ã€‚");
	}
	@Override
	public void Arriving() {
		System.out.println("å…­.æŠµè¾¾ç›®æ ‡å­¦æ ¡ï¼š");
		System.out.println("  1ï¼‰å®‰æ’ä½å®¿ï¼›");
		System.out.println("  2ï¼‰äº†è§£æ ¡å›­åŠå‘¨è¾¹ç¯å¢ƒã€‚");
	}
}
```

```java
public class HookTemplateMethod {
	public static void main(String[] args) {
		HookAbstractClass tm=new HookConcreteClass();
		tm.TemplateMethod();
	}
}
//å«é’©å­æ–¹æ³•çš„æŠ½è±¡ç±»
abstract class HookAbstractClass
{
    public void TemplateMethod() //æ¨¡æ¿æ–¹æ³•
    {
    	abstractMethod1();
    	HookMethod1();
        if(HookMethod2())
        {
        	SpecificMethod();
        }
 	    abstractMethod2();
    }
	public void SpecificMethod() //å…·ä½“æ–¹æ³•
	{
		System.out.println("æŠ½è±¡ç±»ä¸­çš„å…·ä½“æ–¹æ³•è¢«è°ƒç”¨...");
	}
	public void HookMethod1(){}  //é’©å­æ–¹æ³•1
	public boolean HookMethod2() //é’©å­æ–¹æ³•2
    {
    	return true;
    }
	public abstract void abstractMethod1(); //æŠ½è±¡æ–¹æ³•1
	public abstract void abstractMethod2(); //æŠ½è±¡æ–¹æ³•2
}
//å«é’©å­æ–¹æ³•çš„å…·ä½“å­ç±»
class HookConcreteClass extends HookAbstractClass
{
	public void abstractMethod1()
	{
		System.out.println("æŠ½è±¡æ–¹æ³•1çš„å®ç°è¢«è°ƒç”¨...");
	}
	public void abstractMethod2()
	{
		System.out.println("æŠ½è±¡æ–¹æ³•2çš„å®ç°è¢«è°ƒç”¨...");
	}
	public void HookMethod1()
    {
		System.out.println("é’©å­æ–¹æ³•1è¢«é‡å†™...");
    }
	public boolean HookMethod2()
    {
		return false;
    }
}
```

![](/13.png)

## ç­–ç•¥æ¨¡å¼ ğŸŒŸğŸŒŸğŸŒŸğŸŒŸ

**å®šä¹‰**

è¯¥æ¨¡å¼ å®šä¹‰äº†ä¸€ç³»åˆ—ç®—æ³•ï¼Œå¹¶å°†æ¯ä¸ªç®—æ³•å°è£…èµ·æ¥ï¼Œä½¿ä»–ä»¬å¯ä»¥ç›¸äº’æ›¿æ¢ï¼Œä¸”ç®—æ³•çš„å˜åŒ–ä¸ä¼šå½±å“åˆ°ä½¿ç”¨ç®—æ³•çš„å®¢æˆ·ã€‚

**ä¼˜ç¼ºç‚¹**

- ä¼˜ç‚¹ï¼š1ï¼‰å¤šé‡æ¡ä»¶è¯­å¥ä¸æ˜“ç»´æŠ¤ï¼Œè€Œä½¿ç”¨ç­–ç•¥æ¨¡å¼å¯ä»¥é¿å…ä½¿ç”¨å¤šé‡æ¡ä»¶è¯­å¥ï¼›2ï¼‰ç­–ç•¥æ¨¡å¼æä¾›äº†ä¸€ç³»åˆ—çš„å¯ä¾›é‡ç”¨çš„ç®—æ³•æ—ï¼Œæ°å½“ä½¿ç”¨ç»§æ‰¿å¯ä»¥æŠŠç®—æ³•æ—çš„å…¬å…±ä»£ç è½¬ç§»åˆ°çˆ¶ç±»é‡Œé¢ï¼Œä»è€Œé¿å…é‡å¤çš„ä»£ç ï¼›3ï¼‰ç­–ç•¥æ¨¡å¼å¯ä»¥æä¾›ç›¸åŒè¡Œä¸ºçš„ä¸åŒå®ç°ï¼Œå®¢æˆ·å¯ä»¥æ ¹æ®ä¸åŒæ—¶é—´æˆ–ç©ºé—´è¦æ±‚é€‰æ‹©ä¸åŒçš„ç­–ç•¥ï¼›4ï¼‰ç­–ç•¥æ¨¡å¼**æä¾›äº†å¯¹â€œå¼€é—­åŸåˆ™â€çš„å®Œç¾æ”¯æŒ**ï¼Œå¯ä»¥åœ¨ä¸ä¿®æ”¹åŸä»£ç çš„æƒ…å†µä¸‹ï¼Œçµæ´»å¢åŠ æ–°ç®—æ³•ï¼›5ï¼‰ç­–ç•¥æ¨¡å¼æŠŠç®—æ³•çš„ä½¿ç”¨æ”¾åˆ°ç¯å¢ƒç±»ä¸­ï¼Œè€Œç®—æ³•çš„å®ç°ç§»åˆ°å…·ä½“ç­–ç•¥ç±»ä¸­ï¼Œå®ç°äº†äºŒè€…çš„åˆ†ç¦»ã€‚

- ç¼ºç‚¹ï¼š1ï¼‰å®¢æˆ·ç«¯å¿…é¡»ç†è§£æ‰€æœ‰ç­–ç•¥ç®—æ³•çš„åŒºåˆ«ï¼Œä»¥ä¾¿é€‚æ—¶é€‰æ‹©æ°å½“çš„ç®—æ³•ç±»ï¼›2ï¼‰ç­–ç•¥æ¨¡å¼é€ æˆå¾ˆå¤šçš„ç­–ç•¥ç±»

**ç¤ºä¾‹**

```java
public class StrategyPattern{
	public static void main(String[] args) {
		Context c=new Context();
		Strategy s=new ConcreteStrategyA();
		c.setStrategy(s);
		c.strategyMethod();
		System.out.println("-----------------");
		s=new ConcreteStrategyB();
		c.setStrategy(s);
		c.strategyMethod();
	}
}
//æŠ½è±¡ç­–ç•¥ç±»
interface Strategy{
    public void strategyMethod();//ç­–ç•¥æ–¹æ³•
}
//å…·ä½“ç­–ç•¥ç±»A
class ConcreteStrategyA implements Strategy{
    public void strategyMethod() {
    	System.out.println("å…·ä½“ç­–ç•¥Açš„ç­–ç•¥æ–¹æ³•è¢«è®¿é—®ï¼");
    }
}
//å…·ä½“ç­–ç•¥ç±»B
class ConcreteStrategyB implements Strategy{
  public void strategyMethod() {
  	System.out.println("å…·ä½“ç­–ç•¥Bçš„ç­–ç•¥æ–¹æ³•è¢«è®¿é—®ï¼");
  }
}
//ç¯å¢ƒç±»
class Context{
	private Strategy strategy;
	public Strategy getStrategy() {
		return strategy;
	}
	public void setStrategy(Strategy strategy) {
		this.strategy = strategy;
	}
	public void strategyMethod() {
		strategy.strategyMethod();
    }
}
```

```java
import java.awt.*;
import java.awt.event.*;
import javax.swing.*;
public class CrabCookingStrategy implements ItemListener{
	private JFrame f;
	private JRadioButton qz,hs;
	private JPanel CenterJP,SouthJP;
	private Kitchen cf; //å¨æˆ¿
	private CrabCooking qzx,hsx; //å¤§é—¸èŸ¹åŠ å·¥è€…
	CrabCookingStrategy(){
		f=new JFrame("ç­–ç•¥æ¨¡å¼åœ¨å¤§é—¸èŸ¹åšèœä¸­çš„åº”ç”¨");
        f.setBounds(100, 100, 500, 400);
        f.setVisible(true);
        f.setResizable(false);
        f.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        SouthJP=new JPanel();
        CenterJP=new JPanel();
        f.add("South",SouthJP);
        f.add("Center",CenterJP);
        qz=new JRadioButton("æ¸…è’¸å¤§é—¸èŸ¹");
        hs=new JRadioButton("çº¢çƒ§å¤§é—¸èŸ¹");
        qz.addItemListener(this);
        hs.addItemListener(this);
        ButtonGroup group=new ButtonGroup();
        group.add(qz);
        group.add(hs);
        SouthJP.add(qz);
        SouthJP.add(hs);
		//---------------------------------
        cf=new Kitchen(); //å¨æˆ¿
		qzx=new SteamedCrabs(); //æ¸…è’¸å¤§é—¸èŸ¹ç±»
		hsx=new BraisedCrabs(); //çº¢çƒ§å¤§é—¸èŸ¹ç±»
	}
	public void itemStateChanged(ItemEvent e) {
		JRadioButton jc=(JRadioButton) e.getSource();
		if(jc==qz){
			cf.setStrategy(qzx);
			cf.CookingMethod(); //æ¸…è’¸
		}else if(jc==hs){
			cf.setStrategy(hsx);
			cf.CookingMethod(); //çº¢çƒ§
		}
		CenterJP.removeAll();
		CenterJP.repaint();
		CenterJP.add((Component)cf.getStrategy());
		f.setVisible(true);
	}
	public static void main(String[] args) {
		new CrabCookingStrategy();
	}
}
//æŠ½è±¡ç­–ç•¥ç±»ï¼šå¤§é—¸èŸ¹åŠ å·¥ç±»
interface CrabCooking{
	public void CookingMethod();//åšèœæ–¹æ³•
}
//å…·ä½“ç­–ç•¥ç±»ï¼šæ¸…è’¸å¤§é—¸èŸ¹
class SteamedCrabs extends JLabel implements CrabCooking{
	private static final long serialVersionUID = 1L;
    public void CookingMethod() {
  	    this.setIcon(new ImageIcon("src/chapter06/strategy/SteamedCrabs.jpg"));
  	    this.setHorizontalAlignment(CENTER);
    }
}
//å…·ä½“ç­–ç•¥ç±»ï¼šçº¢çƒ§å¤§é—¸èŸ¹
class BraisedCrabs extends JLabel implements CrabCooking{
	private static final long serialVersionUID = 1L;
    public void CookingMethod() {
	    this.setIcon(new ImageIcon("src/chapter06/strategy/BraisedCrabs.jpg"));
	    this.setHorizontalAlignment(CENTER);
    }
}
//ç¯å¢ƒç±»ï¼šå¨æˆ¿
class Kitchen{
	private CrabCooking strategy; //æŠ½è±¡ç­–ç•¥
	public void setStrategy(CrabCooking strategy) {
		this.strategy = strategy;
	}
	public CrabCooking getStrategy() {
		return strategy;
	}
	public void CookingMethod() {
		strategy.CookingMethod(); //åšèœ
    }
}
```

![](/14.png)

## å‘½ä»¤æ¨¡å¼ ğŸŒŸğŸŒŸğŸŒŸğŸŒŸ

**å®šä¹‰**

å°†ä¸€ä¸ªè¯·æ±‚å°è£…ä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œä½¿å‘å‡ºè¯·æ±‚çš„è´£ä»»å’Œæ‰§è¡Œè¯·æ±‚çš„è´£ä»»åˆ†å‰²å¼€

**ä¼˜ç¼ºç‚¹**

ä¼˜ç‚¹ï¼š1ï¼‰é™ä½ç³»ç»Ÿçš„è€¦åˆåº¦ã€‚å‘½ä»¤æ¨¡å¼èƒ½å°†è°ƒç”¨æ“ä½œçš„å¯¹è±¡ä¸å®ç°è¯¥æ“ä½œçš„å¯¹è±¡è§£è€¦ï¼›2ï¼‰å¢åŠ æˆ–åˆ é™¤å‘½ä»¤éå¸¸æ–¹ä¾¿ã€‚é‡‡ç”¨å‘½ä»¤æ¨¡å¼å¢åŠ ä¸åˆ é™¤å‘½ä»¤ä¸ä¼šå½±å“å…¶å®ƒç±»ï¼Œ**å®ƒæ»¡è¶³â€œå¼€é—­åŸåˆ™â€**ï¼Œå¯¹æ‰©å±•æ¯”è¾ƒçµæ´»ï¼›3ï¼‰å¯ä»¥å®ç°å®å‘½ä»¤ã€‚å‘½ä»¤æ¨¡å¼å¯ä»¥ä¸ç»„åˆæ¨¡å¼ç»“åˆï¼Œå°†å¤šä¸ªå‘½ä»¤è£…é…æˆä¸€ä¸ªç»„åˆå‘½ä»¤ï¼Œå³å®å‘½ä»¤ï¼›4ï¼‰æ–¹ä¾¿å®ç° Undo å’Œ Redo æ“ä½œã€‚å‘½ä»¤æ¨¡å¼å¯ä»¥ä¸åé¢ç« èŠ‚ä»‹ç»çš„å¤‡å¿˜å½•æ¨¡å¼ç»“åˆï¼Œå®ç°å‘½ä»¤çš„æ’¤æ¶ˆä¸æ¢å¤ã€‚

ç¼ºç‚¹ï¼šå¯èƒ½äº§ç”Ÿå¤§é‡å…·ä½“å‘½ä»¤ç±»ã€‚å› ä¸ºé’ˆå¯¹æ¯ä¸€ä¸ªå…·ä½“æ“ä½œéƒ½éœ€è¦è®¾è®¡ä¸€ä¸ªå…·ä½“å‘½ä»¤ç±»ï¼Œè¿™å°†å¢åŠ ç³»ç»Ÿçš„å¤æ‚æ€§ã€‚

**ç¤ºä¾‹**

```java
public class CommandPattern {
	public static void main(String[] args) {
		Command cmd=new ConcreteCommand();
		Invoker ir=new Invoker(cmd);
		System.out.println("å®¢æˆ·è®¿é—®è°ƒç”¨è€…çš„call()æ–¹æ³•...");
		ir.call();
	}
}
//è°ƒç”¨è€…
class Invoker
{
	private Command command;
	public Invoker(Command command)
	{
		this.command=command;
	}
	public void setCommand(Command command)
	{
		this.command=command;
	}
	public void call()
	{
		System.out.println("è°ƒç”¨è€…æ‰§è¡Œå‘½ä»¤command...");
		command.execute();
	}
}
//æŠ½è±¡å‘½ä»¤
interface Command
{
	public abstract void execute();
}
//å…·ä½“å‘½ä»¤
class ConcreteCommand implements Command
{
	private Receiver receiver;
	ConcreteCommand(){
		receiver=new Receiver();
	}
	public void execute()
	{
		receiver.action();
	}
}
//æ¥æ”¶è€…
class Receiver
{
	public void action()
	{
		System.out.println("æ¥æ”¶è€…çš„action()æ–¹æ³•è¢«è°ƒç”¨...");
	}
}
```

```java
import java.util.ArrayList;
public class CompositeCommandPattern {
	public static void main(String[] args) {
		AbstractCommand cmd1=new ConcreteCommand1();
		AbstractCommand cmd2=new ConcreteCommand2();
		CompositeInvoker ir=new CompositeInvoker();
		ir.add(cmd1);
		ir.add(cmd2);
		System.out.println("å®¢æˆ·è®¿é—®è°ƒç”¨è€…çš„execute()æ–¹æ³•...");
		ir.execute();
	}
}
//æŠ½è±¡å‘½ä»¤
interface AbstractCommand
{
	public abstract void execute();
}
//æ ‘å¶æ„ä»¶: å…·ä½“å‘½ä»¤1
class ConcreteCommand1 implements AbstractCommand
{
	private CompositeReceiver receiver;
	ConcreteCommand1(){
		receiver=new CompositeReceiver();
	}
	public void execute()
	{
		receiver.action1();
	}
}
//æ ‘å¶æ„ä»¶: å…·ä½“å‘½ä»¤2
class ConcreteCommand2 implements AbstractCommand
{
	private CompositeReceiver receiver;
	ConcreteCommand2(){
		receiver=new CompositeReceiver();
	}
	public void execute()
	{
		receiver.action2();
	}
}
//æ ‘ææ„ä»¶: è°ƒç”¨è€…
class CompositeInvoker implements AbstractCommand
{
	private ArrayList<AbstractCommand> children = new ArrayList<AbstractCommand>();
	public void add(AbstractCommand c)
	{
		children.add(c);
	}
	public void remove(AbstractCommand c)
	{
		children.remove(c);
	}
	public AbstractCommand getChild(int i)
	{
		return children.get(i);
	}
	public void execute()
	{
		for(Object obj:children)
		{
			((AbstractCommand)obj).execute();
		}
	}
}
//æ¥æ”¶è€…
class CompositeReceiver
{
	public void action1()
	{
		System.out.println("æ¥æ”¶è€…çš„action1()æ–¹æ³•è¢«è°ƒç”¨...");
	}
	public void action2()
	{
		System.out.println("æ¥æ”¶è€…çš„action2()æ–¹æ³•è¢«è°ƒç”¨...");
	}
}
```

```java
import javax.swing.*;
public class CookingCommand {
	public static void main(String[] args) {
		Breakfast food1=new ChangFen();
		Breakfast food2=new HunTun();
		Breakfast food3=new HeFen();
		Waiter fwy=new Waiter();
		fwy.setChangFen(food1);//è®¾ç½®è‚ ç²‰èœå•
		fwy.setHunTun(food2);  //è®¾ç½®æ²³ç²‰èœå•
		fwy.setHeFen(food3);   //è®¾ç½®é¦„é¥¨èœå•
		fwy.chooseChangFen();  //é€‰æ‹©è‚ ç²‰
		fwy.chooseHeFen();     //é€‰æ‹©æ²³ç²‰
		fwy.chooseHunTun();    //é€‰æ‹©é¦„é¥¨
	}
}
//è°ƒç”¨è€…ï¼šæœåŠ¡å‘˜
class Waiter
{
	private Breakfast changFen,hunTun,heFen;
	public void setChangFen(Breakfast f)
	{
		changFen=f;
	}
	public void setHunTun(Breakfast f)
	{
		hunTun=f;
	}
	public void setHeFen(Breakfast f)
	{
		heFen=f;
	}
	public void chooseChangFen()
	{
		changFen.cooking();
	}
	public void chooseHunTun()
	{
		hunTun.cooking();
	}
	public void chooseHeFen()
	{
		heFen.cooking();
	}
}
//æŠ½è±¡å‘½ä»¤ï¼šæ—©é¤
interface Breakfast
{
	public abstract void cooking();
}
//å…·ä½“å‘½ä»¤ï¼šè‚ ç²‰
class ChangFen implements Breakfast
{
	private ChangFenChef receiver;
	ChangFen(){
		receiver=new ChangFenChef();
	}
	public void cooking()
	{
		receiver.cooking();
	}
}
//å…·ä½“å‘½ä»¤ï¼šé¦„é¥¨
class HunTun implements Breakfast
{
	private HunTunChef receiver;
	HunTun(){
		receiver=new HunTunChef();
	}
	public void cooking()
	{
		receiver.cooking();
	}
}
//å…·ä½“å‘½ä»¤ï¼šæ²³ç²‰
class HeFen implements Breakfast
{
	private HeFenChef receiver;
	HeFen(){
		receiver=new HeFenChef();
	}
	public void cooking()
	{
		receiver.cooking();
	}
}
//æ¥æ”¶è€…ï¼šè‚ ç²‰å¨å¸ˆ
class ChangFenChef extends JFrame
{
	private static final long serialVersionUID = 1L;
	JLabel l=new JLabel();
	ChangFenChef(){
		super("ç…®è‚ ç²‰");
		l.setIcon(new ImageIcon("src/chapter06/command/ChangFen.jpg"));
		this.add(l);
		this.setLocation(30, 30);
        this.pack();
	    this.setResizable(false);
	    this.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);

	}
	public void cooking()
	{
		this.setVisible(true);
	}
}
//æ¥æ”¶è€…ï¼šé¦„é¥¨å¨å¸ˆ
class HunTunChef extends JFrame
{
	private static final long serialVersionUID = 1L;
	JLabel l=new JLabel();
	HunTunChef(){
		super("ç…®é¦„é¥¨");
		l.setIcon(new ImageIcon("src/chapter06/command/HunTun.jpg"));
		this.add(l);
		this.setLocation(350, 50);
        this.pack();
	    this.setResizable(false);
	    this.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);

	}
	public void cooking()
	{
		this.setVisible(true);
	}
}
//æ¥æ”¶è€…ï¼šæ²³ç²‰å¨å¸ˆ
class HeFenChef extends JFrame
{
	private static final long serialVersionUID = 1L;
	JLabel l=new JLabel();
	HeFenChef(){
		super("ç…®æ²³ç²‰");
		l.setIcon(new ImageIcon("src/chapter06/command/HeFen.jpg"));
		this.add(l);
		this.setLocation(200, 280);
        this.pack();
	    this.setResizable(false);
	    this.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);

	}
	public void cooking()
	{
		this.setVisible(true);
	}
}
```

![](/15.png)

## èŒè´£é“¾æ¨¡å¼ ğŸŒŸğŸŒŸ

**å®šä¹‰**

ä¸ºäº†é¿å…è¯·æ±‚å‘é€è€…ä¸å¤šä¸ªè¯·æ±‚å¤„ç†è€…è€¦åˆåœ¨ä¸€èµ·ï¼Œ å°†æ‰€æœ‰è¯·æ±‚çš„å¤„ç†è€…é€šè¿‡å‰ä¸€å¯¹è±¡è®°ä½å…¶ä¸‹ä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨è€Œè¿æˆä¸€æ¡é“¾ï¼›å½“æœ‰è¯·æ±‚å‘ç”Ÿæ—¶ï¼Œå¯å°†è¯·æ±‚æ²¿ç€è¿™æ¡é“¾ä¼ é€’ï¼Œç›´åˆ°æœ‰å¯¹è±¡å¤„ç†å®ƒä¸ºæ­¢

**ä¼˜ç¼ºç‚¹**

ä¼˜ç‚¹ï¼š1ï¼‰é™ä½äº†å¯¹è±¡ä¹‹é—´çš„è€¦åˆåº¦ã€‚è¯¥æ¨¡å¼ä½¿å¾—ä¸€ä¸ªå¯¹è±¡æ— éœ€çŸ¥é“åˆ°åº•æ˜¯å“ªä¸€ä¸ªå¯¹è±¡å¤„ç†å…¶è¯·æ±‚ä»¥åŠé“¾çš„ç»“æ„ï¼Œå‘é€è€…å’Œæ¥æ”¶è€…ä¹Ÿæ— éœ€æ‹¥æœ‰å¯¹æ–¹çš„æ˜ç¡®ä¿¡æ¯ã€‚2ï¼‰å¢å¼ºäº†ç³»ç»Ÿçš„å¯æ‰©å±•æ€§ã€‚å¯ä»¥æ ¹æ®éœ€è¦å¢åŠ æ–°çš„è¯·æ±‚å¤„ç†ç±»ï¼Œæ»¡è¶³å¼€é—­åŸåˆ™ï¼› 3ï¼‰å¢å¼ºäº†ç»™å¯¹è±¡æŒ‡æ´¾èŒè´£çš„çµæ´»æ€§ã€‚å½“å·¥ä½œæµç¨‹å‘ç”Ÿå˜åŒ–ï¼Œå¯ä»¥åŠ¨æ€åœ°æ”¹å˜é“¾å†…çš„æˆå‘˜æˆ–è€…è°ƒåŠ¨å®ƒä»¬çš„æ¬¡åºï¼Œä¹Ÿå¯åŠ¨æ€åœ°æ–°å¢æˆ–è€…åˆ é™¤è´£ä»»ã€‚4ï¼‰èŒè´£é“¾ç®€åŒ–äº†å¯¹è±¡ä¹‹é—´çš„è¿æ¥ã€‚æ¯ä¸ªå¯¹è±¡åªéœ€ä¿æŒä¸€ä¸ªæŒ‡å‘å…¶åç»§è€…çš„å¼•ç”¨ï¼Œä¸éœ€ä¿æŒå…¶å®ƒæ‰€æœ‰å¤„ç†è€…çš„å¼•ç”¨ï¼Œè¿™é¿å…äº†ä½¿ç”¨ä¼—å¤šçš„ if æˆ–è€… if-else è¯­å¥ã€‚5ï¼‰è´£ä»»åˆ†æ‹…ã€‚æ¯ä¸ªç±»åªéœ€è¦å¤„ç†è‡ªå·±è¯¥å¤„ç†çš„å·¥ä½œï¼Œä¸è¯¥å¤„ç†çš„ä¼ é€’ç»™ä¸‹ä¸€ä¸ªå¯¹è±¡å®Œæˆï¼Œæ˜ç¡®å„ç±»çš„è´£ä»»èŒƒå›´ï¼Œç¬¦åˆç±»çš„å•ä¸€èŒè´£åŸåˆ™ã€‚

ç¼ºç‚¹ï¼š1ï¼‰ä¸èƒ½ä¿è¯æ¯ä¸ªè¯·æ±‚ä¸€å®šè¢«å¤„ç†ã€‚ç”±äºä¸€ä¸ªè¯·æ±‚æ²¡æœ‰æ˜ç¡®çš„æ¥æ”¶è€…ï¼Œæ‰€ä»¥ä¸èƒ½ä¿è¯å®ƒä¸€å®šä¼šè¢«å¤„ç†ï¼Œè¯¥è¯·æ±‚å¯èƒ½ä¸€ç›´ä¼ åˆ°é“¾çš„æœ«ç«¯éƒ½å¾—ä¸åˆ°å¤„ç†ï¼›2ï¼‰å¯¹äºæ¯”è¾ƒé•¿çš„èŒè´£é“¾ï¼Œè¯·æ±‚çš„å¤„ç†å¯èƒ½æ¶‰åŠåˆ°å¤šä¸ªå¤„ç†å¯¹è±¡ï¼Œç³»ç»Ÿæ€§èƒ½å°†å—åˆ°ä¸€å®šå½±å“ï¼›3ï¼‰èŒè´£é“¾å»ºç«‹çš„åˆç†æ€§è¦é å®¢æˆ·ç«¯æ¥ä¿è¯ï¼Œå¢åŠ äº†å®¢æˆ·ç«¯çš„å¤æ‚æ€§ï¼Œå¯èƒ½ä¼šç”±äºèŒè´£é“¾çš„é”™è¯¯è®¾ç½®è€Œå¯¼è‡´ç³»ç»Ÿå‡ºé”™ï¼Œå¦‚ï¼šå¯èƒ½ä¼šé€ æˆå¾ªç¯è°ƒç”¨

**ç¤ºä¾‹**

```java
public class ChainOfResponsibilityPattern {
	public static void main(String[] args) {
		//ç»„è£…è´£ä»»é“¾
        Handler handler1 = new ConcreteHandler1();
        Handler handler2 = new ConcreteHandler2();
        handler1.setNext(handler2);
        //æäº¤è¯·æ±‚
        handler1.handleRequest("two");
	}
}
//æŠ½è±¡å¤„ç†è€…è§’è‰²
abstract class Handler{
	private Handler next;
    public void setNext(Handler next){
    	this.next = next;
    }
    public Handler getNext(){
        return next;
    }
    //å¤„ç†è¯·æ±‚çš„æ–¹æ³•
    public abstract void handleRequest(String request);
}
//å…·ä½“å¤„ç†è€…è§’è‰²1
class ConcreteHandler1 extends Handler {
	public void handleRequest(String request){
		if(request.equals("one"))
        {
			System.out.println("å…·ä½“å¤„ç†è€…1è´Ÿè´£å¤„ç†è¯¥è¯·æ±‚ï¼");
        }else{
        	if(getNext() != null)
            {
        		getNext().handleRequest(request);
            }else{
            	System.out.println("æ²¡æœ‰äººå¤„ç†è¯¥è¯·æ±‚ï¼");
            }
        }
    }
}
//å…·ä½“å¤„ç†è€…è§’è‰²2
class ConcreteHandler2 extends Handler {
	public void handleRequest(String request){
		if(request.equals("two"))
        {
			System.out.println("å…·ä½“å¤„ç†è€…2è´Ÿè´£å¤„ç†è¯¥è¯·æ±‚ï¼");
        }else{
        	if(getNext() != null)
            {
        		getNext().handleRequest(request);
            }else{
            	System.out.println("æ²¡æœ‰äººå¤„ç†è¯¥è¯·æ±‚ï¼");
            }
        }
    }
}
```

```java
public class LeaveApprovalTest {
	public static void main(String[] args) {
		//ç»„è£…è´£ä»»é“¾
		Leader teacher1 = new ClassAdviser();
		Leader teacher2 = new DepartmentHead();
		Leader teacher3 = new Dean();
		//Leader teacher4 = new DeanOfStudies();
		teacher1.setNext(teacher2);
		teacher2.setNext(teacher3);
		//teacher3.setNext(teacher4);
        //æäº¤è¯·æ±‚
		teacher1.handleRequest(8);
	}
}
//æŠ½è±¡å¤„ç†è€…ï¼šé¢†å¯¼ç±»
abstract class Leader{
	private Leader next;
	public void setNext(Leader next){
		this.next = next;
    }
    public Leader getNext(){
        return next;
    }
    //å¤„ç†è¯·æ±‚çš„æ–¹æ³•
    public abstract void handleRequest(int LeaveDays);
}
//å…·ä½“å¤„ç†è€…1ï¼šç­ä¸»ä»»ç±»
class ClassAdviser extends Leader {
	public void handleRequest(int LeaveDays){
		if(LeaveDays<=2)
        {
			System.out.println("ç­ä¸»ä»»æ‰¹å‡†æ‚¨è¯·å‡" + LeaveDays + "å¤©ã€‚");
        }else{
        	if(getNext() != null)
            {
        		getNext().handleRequest(LeaveDays);
            }else{
          	    System.out.println("è¯·å‡å¤©æ•°å¤ªå¤šï¼Œæ²¡æœ‰äººæ‰¹å‡†è¯¥å‡æ¡ï¼");
            }
        }
    }
}
//å…·ä½“å¤„ç†è€…2ï¼šç³»ä¸»ä»»ç±»
class DepartmentHead extends Leader {
	public void handleRequest(int LeaveDays){
		if(LeaveDays<=7)
        {
			System.out.println("ç³»ä¸»ä»»æ‰¹å‡†æ‚¨è¯·å‡" + LeaveDays + "å¤©ã€‚");
        }else{
        	if(getNext() != null)
            {
      		    getNext().handleRequest(LeaveDays);
            }else{
        	    System.out.println("è¯·å‡å¤©æ•°å¤ªå¤šï¼Œæ²¡æœ‰äººæ‰¹å‡†è¯¥å‡æ¡ï¼");
           }
        }
    }
}
//å…·ä½“å¤„ç†è€…3ï¼šé™¢é•¿ç±»
class Dean extends Leader {
	public void handleRequest(int LeaveDays){
		if(LeaveDays<=10)
      {
			System.out.println("é™¢é•¿æ‰¹å‡†æ‚¨è¯·å‡" + LeaveDays + "å¤©ã€‚");
      }else{
      	if(getNext() != null)
          {
    		    getNext().handleRequest(LeaveDays);
          }else{
      	    System.out.println("è¯·å‡å¤©æ•°å¤ªå¤šï¼Œæ²¡æœ‰äººæ‰¹å‡†è¯¥å‡æ¡ï¼");
         }
      }
  }
}
//å…·ä½“å¤„ç†è€…4ï¼šæ•™åŠ¡å¤„é•¿ç±»
class DeanOfStudies extends Leader {
	public void handleRequest(int LeaveDays){
		if(LeaveDays<=20)
      {
			System.out.println("æ•™åŠ¡å¤„é•¿æ‰¹å‡†æ‚¨è¯·å‡" + LeaveDays + "å¤©ã€‚");
      }else{
      	if(getNext() != null)
          {
    		    getNext().handleRequest(LeaveDays);
          }else{
      	    System.out.println("è¯·å‡å¤©æ•°å¤ªå¤šï¼Œæ²¡æœ‰äººæ‰¹å‡†è¯¥å‡æ¡ï¼");
         }
      }
  }
}
```

![](/16.png)

## çŠ¶æ€æ¨¡å¼ ğŸŒŸğŸŒŸğŸŒŸ

**å®šä¹‰**

å¯¹äºæœ‰çŠ¶æ€çš„å¯¹è±¡ï¼ŒæŠŠå¤æ‚çš„â€œåˆ¤æ–­é€»è¾‘â€æå–åˆ°ä¸åŒçš„çŠ¶æ€å¯¹è±¡ä¸­ï¼Œå…è®¸çŠ¶æ€å¯¹è±¡åœ¨å…¶å†…éƒ¨çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶æ”¹å˜å…¶è¡Œä¸º

**ä¼˜ç¼ºç‚¹**

ä¼˜ç‚¹ï¼š1ï¼‰çŠ¶æ€æ¨¡å¼å°†ä¸ç‰¹å®šçŠ¶æ€ç›¸å…³çš„è¡Œä¸ºå±€éƒ¨åŒ–åˆ°ä¸€ä¸ªçŠ¶æ€ä¸­ï¼Œå¹¶ä¸”å°†ä¸åŒçŠ¶æ€çš„è¡Œä¸ºåˆ†å‰²å¼€æ¥ï¼Œ**æ»¡è¶³â€œå•ä¸€èŒè´£åŸåˆ™â€**ï¼›2ï¼‰å‡å°‘å¯¹è±¡é—´çš„ç›¸äº’ä¾èµ–ã€‚å°†ä¸åŒçš„çŠ¶æ€å¼•å…¥åˆ°ç‹¬ç«‹çš„å¯¹è±¡ä¸­ä¼šä½¿å¾—çŠ¶æ€è½¬æ¢å˜å¾—æ›´åŠ æ˜ç¡®ï¼Œä¸”å‡å°‘å¯¹è±¡é—´çš„ç›¸äº’ä¾èµ–ï¼›3ï¼‰æœ‰åˆ©äºç¨‹åºçš„æ‰©å±•ã€‚é€šè¿‡å®šä¹‰æ–°çš„å­ç±»å¾ˆå®¹æ˜“åœ°å¢åŠ æ–°çš„çŠ¶æ€å’Œè½¬æ¢ã€‚

ç¼ºç‚¹ï¼š1ï¼‰çŠ¶æ€æ¨¡å¼çš„ä½¿ç”¨å¿…ç„¶ä¼šå¢åŠ ç³»ç»Ÿçš„ç±»ä¸å¯¹è±¡çš„ä¸ªæ•°ï¼›2ï¼‰çŠ¶æ€æ¨¡å¼çš„ç»“æ„ä¸å®ç°éƒ½è¾ƒä¸ºå¤æ‚ï¼Œå¦‚æœä½¿ç”¨ä¸å½“ä¼šå¯¼è‡´ç¨‹åºç»“æ„å’Œä»£ç çš„æ··ä¹±ã€‚

**ç¤ºä¾‹**

```java
import java.util.HashMap;
public class FlyweightStatePattern {
	public static void main(String[] args) {
		ShareContext context = new ShareContext(); //åˆ›å»ºç¯å¢ƒ
        context.Handle(); //å¤„ç†è¯·æ±‚
        context.Handle();
        context.Handle();
        context.Handle();
	}
}
//ç¯å¢ƒç±»
class ShareContext
{
	private ShareState state;
    private HashMap<String, ShareState> stateSet = new HashMap<String, ShareState>();
    public ShareContext()
    {
    	state = new ConcreteState1();
	    stateSet.put("1", state);
        state = new ConcreteState2();
	    stateSet.put("2", state);
        state = getState("1");
    }
    //è®¾ç½®æ–°çŠ¶æ€
    public void setState(ShareState state) {
        this.state = state;
    }
    //è¯»å–çŠ¶æ€
    public ShareState getState(String key) {
	    ShareState s = (ShareState)stateSet.get(key);
	    return s;
    }
    //å¯¹è¯·æ±‚åšå¤„ç†
    public void Handle()
    {
        state.Handle(this);
    }
}
//æŠ½è±¡çŠ¶æ€ç±»
abstract class ShareState
{
	public abstract void Handle(ShareContext context);
}
//å…·ä½“çŠ¶æ€1ç±»
class ConcreteState1 extends ShareState
{
	public void Handle(ShareContext context)
    {
		System.out.println("å½“å‰çŠ¶æ€æ˜¯ï¼š çŠ¶æ€1");
        context.setState(context.getState("2"));
    }
}
//å…·ä½“çŠ¶æ€2ç±»
class ConcreteState2 extends ShareState
{
    public void Handle(ShareContext context)
    {
        System.out.println("å½“å‰çŠ¶æ€æ˜¯ï¼š çŠ¶æ€2");
        context.setState(context.getState("1"));
    }
}
```

```java
public class ScoreStateTest {
	public static void main(String[] args) {
		ScoreContext account=new ScoreContext();
		System.out.println("å­¦ç”Ÿæˆç»©çŠ¶æ€æµ‹è¯•ï¼š");
		account.add(30);
		account.add(40);
		account.add(25);
		account.add(-15);
		account.add(-25);
	}
}
//ç¯å¢ƒç±»
class ScoreContext
{
	private AbstractState state;
	ScoreContext()
	{
		state=new LowState(this);
	}
	public void setState(AbstractState state)
	{
		this.state=state;
	}
	public AbstractState getState()
	{
		return state;
	}
	public void add(int score)
	{
		state.addScore(score);
	}
}
//æŠ½è±¡çŠ¶æ€ç±»
abstract class AbstractState
{
	protected ScoreContext hj;  //ç¯å¢ƒ
	protected String stateName; //çŠ¶æ€å
	protected int score; //åˆ†æ•°
	public abstract void checkState(); //æ£€æŸ¥å½“å‰çŠ¶æ€
    public void addScore(int x)
	{
		score+=x;
		System.out.print("åŠ ä¸Šï¼š "+x+"åˆ†ï¼Œ\tå½“å‰åˆ†æ•°ï¼š"+score );
		checkState();
		System.out.println("åˆ†ï¼Œ\tå½“å‰çŠ¶æ€ï¼š"+hj.getState().stateName);
	}
}
//å…·ä½“çŠ¶æ€ç±»ï¼šä¸åŠæ ¼
class LowState extends AbstractState
{
	public LowState(ScoreContext h)
	{
		hj=h;
		stateName="ä¸åŠæ ¼";
		score=0;
	}
	public LowState(AbstractState state)
	{
		hj=state.hj;
		stateName="ä¸åŠæ ¼";
		score=state.score;
	}
	public void checkState()
	{
		if(score>=90)
		{
			hj.setState(new HighState(this));
		}
		else if(score>=60)
		{
			hj.setState(new MiddleState(this));
		}
	}
}
//å…·ä½“çŠ¶æ€ç±»ï¼šä¸­ç­‰
class MiddleState extends AbstractState
{
	public MiddleState(AbstractState state)
	{
		hj=state.hj;
		stateName="ä¸­ç­‰";
		score=state.score;
	}
	public void checkState()
	{
		if(score<60)
		{
			hj.setState(new LowState(this));
		}
		else if(score>=90)
		{
			hj.setState(new HighState(this));
		}
	}
}
//å…·ä½“çŠ¶æ€ç±»ï¼šä¼˜ç§€
class HighState extends AbstractState
{
	public HighState(AbstractState state)
	{
		hj=state.hj;
		stateName="ä¼˜ç§€";
		score=state.score;
	}
	public void checkState()
	{
		if(score<60)
		{
			hj.setState(new LowState(this));
		}
		else if(score<90)
		{
			hj.setState(new MiddleState(this));
		}
	}
}
```

```java
public class StatePatternClient {
	public static void main(String[] args) {
        Context context = new Context();//åˆ›å»ºç¯å¢ƒ
        context.Handle(); //å¤„ç†è¯·æ±‚
        context.Handle();
        context.Handle();
        context.Handle();
	}
}
//ç¯å¢ƒç±»
class Context
{
    private State state;
    //å®šä¹‰ç¯å¢ƒç±»çš„åˆå§‹çŠ¶æ€
    public Context()
    {
        this.state = new ConcreteStateA();
    }
    //è®¾ç½®æ–°çŠ¶æ€
    public void setState(State state) {
        this.state = state;
    }
    //è¯»å–çŠ¶æ€
    public State getState() {
        return(state);
    }
    //å¯¹è¯·æ±‚åšå¤„ç†
    public void Handle()
    {
        state.Handle(this);
    }
}
//æŠ½è±¡çŠ¶æ€ç±»
abstract class State
{
    public abstract void Handle(Context context);
}
//å…·ä½“çŠ¶æ€Aç±»
class ConcreteStateA extends State
{
    public void Handle(Context context)
    {
        System.out.println("å½“å‰çŠ¶æ€æ˜¯ A.");
        context.setState(new ConcreteStateB());
    }
}
//å…·ä½“çŠ¶æ€Bç±»
class ConcreteStateB extends State
{
    public void Handle(Context context)
    {
        System.out.println("å½“å‰çŠ¶æ€æ˜¯ B.");
        context.setState(new ConcreteStateA());
    }
}
```

```java
public class ThreadStateTest {
	public static void main(String[] args) {
		ThreadContext context=new ThreadContext();
		context.start();
		context.getCPU();
		context.suspend();
		context.resume();
		context.getCPU();
		context.stop();
	}
}
//ç¯å¢ƒç±»
class ThreadContext
{
	private ThreadState state;
	ThreadContext()
	{
		state=new New();
	}
	public void setState(ThreadState state)
	{
		this.state=state;
	}
	public ThreadState getState()
	{
		return state;
	}
	public void start()
	{
		((New) state).start(this);
	}
	public void getCPU()
	{
		((Runnable) state).getCPU(this);
	}
	public void suspend()
	{
		((Running) state).suspend(this);
	}
	public void stop()
	{
		((Running) state).stop(this);
	}
	public void resume()
	{
		((Blocked) state).resume(this);
	}
}
//æŠ½è±¡çŠ¶æ€ç±»ï¼šçº¿ç¨‹çŠ¶æ€
abstract class ThreadState
{
	protected String stateName; //çŠ¶æ€å
}
//å…·ä½“çŠ¶æ€ç±»ï¼šæ–°å»ºçŠ¶æ€
class New extends ThreadState
{
	public New()
	{
		stateName="æ–°å»ºçŠ¶æ€";
        System.out.println("å½“å‰çº¿ç¨‹å¤„äºï¼šæ–°å»ºçŠ¶æ€.");
	}
	public void start(ThreadContext hj)
	{
		System.out.print("è°ƒç”¨start()æ–¹æ³•-->");
		if(stateName.equals("æ–°å»ºçŠ¶æ€"))
		{
			hj.setState(new Runnable());
		}
		else
		{
			System.out.println("å½“å‰çº¿ç¨‹ä¸æ˜¯æ–°å»ºçŠ¶æ€ï¼Œä¸èƒ½è°ƒç”¨start()æ–¹æ³•.");
		}
	}
}
//å…·ä½“çŠ¶æ€ç±»ï¼šå°±ç»ªçŠ¶æ€
class Runnable extends ThreadState
{
	public Runnable()
	{
		stateName="å°±ç»ªçŠ¶æ€";
        System.out.println("å½“å‰çº¿ç¨‹å¤„äºï¼šå°±ç»ªçŠ¶æ€.");
	}
	public void getCPU(ThreadContext hj)
	{
		System.out.print("è·å¾—CPUæ—¶é—´-->");
		if(stateName.equals("å°±ç»ªçŠ¶æ€"))
		{
			hj.setState(new Running());
		}
		else
		{
			System.out.println("å½“å‰çº¿ç¨‹ä¸æ˜¯å°±ç»ªçŠ¶æ€ï¼Œä¸èƒ½è·å–CPU.");
		}
	}
}
//å…·ä½“çŠ¶æ€ç±»ï¼šè¿è¡ŒçŠ¶æ€
class Running extends ThreadState
{
	public Running()
	{
		stateName="è¿è¡ŒçŠ¶æ€";
        System.out.println("å½“å‰çº¿ç¨‹å¤„äºï¼šè¿è¡ŒçŠ¶æ€.");
	}
	public void suspend(ThreadContext hj)
	{
		System.out.print("è°ƒç”¨suspend()æ–¹æ³•-->");
		if(stateName.equals("è¿è¡ŒçŠ¶æ€"))
		{
			hj.setState(new Blocked());
		}
		else
		{
			System.out.println("å½“å‰çº¿ç¨‹ä¸æ˜¯è¿è¡ŒçŠ¶æ€ï¼Œä¸èƒ½è°ƒç”¨suspend()æ–¹æ³•.");
		}
	}
	public void stop(ThreadContext hj)
	{
		System.out.print("è°ƒç”¨stop()æ–¹æ³•-->");
		if(stateName.equals("è¿è¡ŒçŠ¶æ€"))
		{
			hj.setState(new Dead());
		}
		else
		{
			System.out.println("å½“å‰çº¿ç¨‹ä¸æ˜¯è¿è¡ŒçŠ¶æ€ï¼Œä¸èƒ½è°ƒç”¨stop()æ–¹æ³•.");
		}
	}
}
//å…·ä½“çŠ¶æ€ç±»ï¼šé˜»å¡çŠ¶æ€
class Blocked extends ThreadState
{
	public Blocked()
	{
		stateName="é˜»å¡çŠ¶æ€";
        System.out.println("å½“å‰çº¿ç¨‹å¤„äºï¼šé˜»å¡çŠ¶æ€.");
	}
	public void resume(ThreadContext hj)
	{
		System.out.print("è°ƒç”¨resume()æ–¹æ³•-->");
		if(stateName.equals("é˜»å¡çŠ¶æ€"))
		{
			hj.setState(new Runnable());
		}
		else
		{
			System.out.println("å½“å‰çº¿ç¨‹ä¸æ˜¯é˜»å¡çŠ¶æ€ï¼Œä¸èƒ½è°ƒç”¨resume()æ–¹æ³•.");
		}
	}
}
//å…·ä½“çŠ¶æ€ç±»ï¼šæ­»äº¡çŠ¶æ€
class Dead extends ThreadState
{
	public Dead()
	{
		stateName="æ­»äº¡çŠ¶æ€";
        System.out.println("å½“å‰çº¿ç¨‹å¤„äºï¼šæ­»äº¡çŠ¶æ€.");
	}
}
```

![](/17.png)

